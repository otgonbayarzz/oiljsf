<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core" template="template.xhtml"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="content">
		<h:panelGroup id="dummy" class="kakakakak">
			<h:inputText id="qqo" value="#{dmController.i}">
			</h:inputText>

		</h:panelGroup>
		<div class="row">
			<div class="col-md-1">
				<p:progressBar />

			</div>

		</div>
		<p:poll interval="1"
			listener="#{dmController.setI(dmController.getI() + 1)}"
			update="form:dummy" autoStart="false" widgetVar="poll" />
		<h:commandButton styleClass="loaderButtonClassUnique btn btn-primary"
			actionListener="#{dmController.start()}" onclick="start();"
			value="start">
			<f:ajax execute="@form" render="result" />
		</h:commandButton>

		<h:commandButton styleClass="loaderButtonClassUnique btn btn-danger"
			actionListener="#{dmController.stop()}" value="stop"
			onclick="cancel();">
			<f:ajax execute="@form" render="result" />
		</h:commandButton>
		<script>
			//<![CDATA[

			$(document).ready(function() {
				
				PF('spinner').getJQ().hide();

			});

			function start() {
				var kk =  #{dmController.i};
				window['progress'] = setInterval(function() {
					var pbClient = PF('spinner'), oldValue = pbClient
							.getValue(), newValue = oldValue + 10;
					
						if($('#form\\:qqo').val() <20)
						{
							if($('#form\\:qqo').val() % 2 === 0)
								pbClient.setValue(pbClient.getValue() + 10);
						}
						else
							{
								#{dmController.setI(0)}
								$('#form\\:qqo').val= 0;
								cancel();
							}


				}, 1000);
			}

			function cancel() {
				clearInterval(window['progress']);
				#{dmController.setI(0)}
				$('#form\\:qqo').val= 0;
				PF('spinner').setValue(0);

			}
			//]]>
		</script>
	</ui:define>
</ui:composition>